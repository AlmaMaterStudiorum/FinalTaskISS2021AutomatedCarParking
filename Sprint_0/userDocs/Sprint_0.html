<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
bazul{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #007FFF;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}

.marginauto {
    margin: 10px auto 20px;
    display: block;
}

</style>
    
<head>
   
<title>Marchesini</title></head>
    
<body>
<div id="top">
<h1>LABORATORIO DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
 
 
<h2>Requirements</h2>
<h3>Automated Car-Parking</h3> 

A company intends to build an <i>automating parking service</i> composed of a set of elements:

<ul>
<li>A software system, named <em>ParkManagerService</em>, that implements the required automation functions.</li>
<li>A <tt>DDR</tt> robot working as a <em>transport trolley</em>, that is intially situated in its <em>home</em> location. 
The <tt>transport trolley</tt> has the form of a square of side length <em>RD</em>.
</li>
<li>A <em>parking-area</em> is an empty room that includes;
	<ul>
	<li>an <em>INDOOR</em> to enter the car in the area. Facing the <tt>INDOOR</tt>, there is
	a <em>INDOOR-area</em> equipped with a <em>weigthsensor</em> that measures the <em>weigth</em> of the car;</li>
	<li>an <em>OUTDOOR</em> to exit from the <tt>parking-area</tt>. Just after the <tt>OUTDOOR</tt>, there is
	<em>OUTDOOR-area</em> equipped with a <em>outsonar</em>, used to detect the presence of a car.
	The <tt>OUTDOOR-area</tt>, once engaded by a car, should be freed within a prefixed interval of time <em>DTFREE</em>; </li>
	<li>a number <tt>N (N=6)</tt> of <em>parking-slots</em>;</li>
	<li>a <em>thermometer</em> that measures the temperature <em>TA</em> of the area;</li>
	<li>a <em>fan</em> that should be activated when <k>TA > TMAX</k>, where <em>TMAX</em> is a prefixed value (e.g. <tt>35</tt>)</li>
	</ul>
	A <em>map</em> of the parking area, represented as a grid of squares of side length <em>RD</em>, 
	is available in the file <a href="parkingMap.txt" target="code">parkingMap.txt</a>:
	<pre>
|r, 0, 0, 0, 0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, 0, 0, 0, 0, 0, X, 
|X, X, X, X, X, X, X, X, </pre>
	The map includes the positions of the  <tt>parking-slots</tt> (marked above with the symbol <k>X</k>) 
	and of the <em>fixed obstacles</em> in the area (the walls marked with the symbol <b>X</b>).
	<br/><br/>
	The area marked with <k>X</k> is a sort of 'equipped area' upon which the <tt>transport trolley</tt> cannot walk.
	Thus, to get the car in the <tt>parking-slot</tt> <ks>(2,2)</ks>, the <tt>transport trolley</tt> must
	go in cell <ks>(1,2)</ks>.
	<br/><br/>

	The proper scene for the WEnv is reported in: <a href="parkingAreaConfig.js" target="code">parkingAreaConfig.js</a>
 
	
	<center><img src="./img/parkingAreaZone.PNG" alt="parkingAreaZone.PNG" width="45%" height="32%"/></center>
</li>	
<li>a <em>parking-manager</em> (an human being) which supervises the state of the <tt>parking-area</tt>
and handles critical situations<!-- by using a software system named <em>ParkMonitoringService</em> -->. </li>
</ul>

<div class="remark">
The job of our company is to design, build and deploy the  <em>ParkManagerService</em>.
</div>
<!-- and the <em>ParkMonitoringService</em>.-->
<h3>User stories</h3>
As a <bc>client - parking phase</bc> :
<ul>
<li>I intend to use a <em>ParkServiceGUI</em> provided by the <tt>ParkManagerService</tt>  to notify my interest in <i>entering</i> 
my auto in the <tt>parking-area</tt> and to receive as answer the number <em>SLOTNUM</em> of a  free parking-slot  (<tt>1&lt;=SLOTNUM&lt;=6</tt>). 
<tt>SLOTNUM<k>==0</k></tt> means that no free slot is available.</em>

</li>
<li>If <tt>SLOTNUM <k>>0</k></tt>, I move my car in front to the <tt>INDOOR</tt>, get out of the car and afterwards press a <em>CARENTER</em> button on the
<em>ParkServiceGUI</em>. Afterwards, the <tt>transport trolley</tt> takes over my car and moves it from the <tt>INDOOR</tt> 
to the selected <tt>parking-slot</tt>.
The <tt>ParkServiceGUI</tt> will show to me a receipt that includes a (unique) <em>TOKENID</em>, 
to be used in the <i>car pick up</i> phase.</li>
</ul>

As a <bc>client - car pick up phase</bc> :
<ul>
<li>I intend to use the <tt>ParkServiceGUI</tt> to submit the request to pick up my car, by sending the <tt>TOKENID</tt> previously received. </li>  
<li>Afterwards, the <tt>transport trolley</tt>  takes over my car and moves it from its <tt>parking-slot</tt> to the <tt>OUTDOOR-area</tt>.</li>
<li>I move the car, so to free the <tt>OUTDOOR-area</tt>.
</li>
 </ul>

As a <bc>parking-manager</bc>:
<ul>
<li>I intend to use the <em>ParkServiceStatusGUI</em>  provided by the <tt>ParkManagerService</tt>
to observe the <em>current state</em> of the <tt>parking area</tt>, including the value <tt>TA</tt> of the temperature,
the state of the <tt>fan</tt> and the state of the <tt>transport trolley</tt> (<k>idle, working or stopped</k>).</li>
<li>I intend to <em>stop</em> the <tt>transport trolley</tt> when <k>TA > TMAX</k>, activate the <tt>fan</tt> and 
wait until <k>TA &lt; TMAX</k>. At this time, I stop the <tt>fan</tt> and resume the behavior of the <tt>transport trolley</tt>.
Hopefully, the <b>start/stop</b> <ks>of the fan</ks> could also be automated by the <tt>ParkManagerService</tt>,
while the <b>start/stop</b> <ks>of the transport trolley</ks> is always up to me.
</li>

<li>I expect that the <tt>ParkManagerService</tt> sends to me an <em>alarm</em> if it detectes that the <tt>OUTDOOR-area</tt>
has not been cleaned within the <tt>DTFREE</tt> interval of time.</li>
</ul>
 
 
<h3>Requirements </h3>

The <tt>ParkManagerService</tt>  should create the <tt>ParkServiceGUI</tt> (for the client) 
and the <tt>ParkServiceStatusGUI</tt> (for the manager) and then perform the following tasks:


<ul>
 
<li><hr/>
<em>acceptIN</em>: accept the request of a client to park the car if there is at least one <tt>parking-slot</tt> available,
select a free slot identified with a unique <tt>SLOTNUM</tt>.<br/>
A request of this type can be elaborated only when the <k><tt>INDOOR-area</tt> is free</k>, 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager). 
If the <tt>INDOOR-area</tt> is already engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice). 
<br/>
  <li><em>informIN</em>: inform the client about the value of the <tt>SLOTNUM</tt>.</li> 
If  <k>SLOTNUM>0</k>:
  <ol>
   <li><em>moveToIn</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>INDOOR</tt> ;</li>
  <li><em>receipt</em>: send to the client a receipt including the value of the <tt>TOKENID</tt> ;</li> 
  <li><em>moveToSlotIn</em>: move the <tt>transport trolley</tt> from the <tt>INDOOR</tt> to the selected <tt>parking-slot</tt>;</li>
  <!-- <li>accept another request (<tt>acceptIN</tt> or <tt>acceptOUT</tt>). -->
  <li><em>backToHome</em>: if no other request is present,  move the <tt>transport trolley</tt> to its <tt>home</tt> location,
  else <em>acceptIN</em> or <em>acceptOUT</em>.</li> 
  </ol>
 </li>
If <k>SLOTNUM==0</k>: 
	<ul>
	<li><em>moveToHome</em>: if not already at home, move the <tt>transport trolley</tt> to its <tt>home</tt> location.</li> 
	</ul>
</li>


<li><hr/>
<em>acceptOUT</em>: accept the request of a client to get out the car with <tt>TOKENID</tt>.
A request of this type can be elaborated only when the <k><tt>OUTDOOR-area</tt> is free</k> 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager).
If the <tt>OUTDOOR-area</tt> is still engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice).

	<ol>
	<li><em>findSlot</em>: deduce the number of the parking slot (<em>CARSLOTNUM</em>) from the <tt>TOKENID</tt>;</li>
	<li><em>moveToSlotOut</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>CARSLOTNUM/parking-slot</tt> ;</li>
	<li><em>moveToOut</em>: move the <tt>transport trolley</tt> to the <tt>OUTDOOR</tt> ;</li>
	<li><em>moveToHome</em>: if no other request is present  move the <tt>transport trolley</tt> to its <tt>home</tt> location; <br/>
	else <em>acceptIN</em> or <em>acceptOUT</em></li> 

	</ol> 
</li>
<li>
<hr/>
<em>monitor</em>: update the <tt>ParkServiceStatusGUI</tt> with the required information about the state of the system.
</li>

<li>
<hr/>
<em>manage</em>: accept the request of the manager to stop/resume the behavior of the  <tt>transport trolley</tt>.
</li>

</ul>
<h4>About the devices</h4>
All the sensors (<tt>weigthsensor</tt>, <tt>outsonar</tt>, <tt>thermometer</tt> ) and the <tt>fan</tt> should be properly simulated
by mock-objects or mock-actors.

<h4>When using a real robot</h4>
No further requirement.

<h4>When available a Raspberry and a sonar</h4>
The <tt>outsonar</tt> could be a real device. We can simulate the presence/absence of a car.

    <h4>When using <k>only</k> the virtual robot or <k>no real sonar</k> available</h4>
Consider the new requirement:
<ul>
<li><ks>authorize</ks>: allow a manager to use the <tt>ParkServiceStatusGUI</tt> only if she/he owns <bc>proper permissions</bc>.</li>
 
</ul>
 

 

<h2>Requirement analysis</h2>
During a meeting with the client the following definitions are clarified: 
<ul>
<li><ks>ParkManagerService</ks>: A computer system that meets the customer's requirements,it is composed of entities that communicate with each other and can potentially communicate with entities outside the system.</li>
<li><ks>transport trolley</ks>: An entity that can move around the parking area in the <b>permitted areas</b>, communicate with other information entities or receive commands, load and unload a car.  </li>
<li><ks>home</ks>: Specific position of the trolley within the parking area. It is the starting position and the destination position in case no tasks are assigned to the trolley. In this position the trolley does not contain the car. Position (1,1) of map.</li>
<li><ks>parking-area</ks>: Permissible area for the trolley. Notable position : inaccessible positions called slots, positions beside the slots for loading and unloading cars, a position adjacent of INDOOR-area for loading the car from the outside of the system, an position adjacent OUTDOOR-area position for unloading towards the outside system, a home position.</li>
<li><ks>INDOOR</ks>: Abstract separation surface between the exterior of the system and the parking area. Separate the parking-area from the INDOOR-car position to perform the car loading(UPLOAD) operation.</li>
<li><ks>OUTDOOR</ks>: Abstract separation surface between the exterior of the system and the parking area. Separate the parking-area from the OUTDOOR-car position to perform the car unloading (DOWNLOAD) operation.</li>
<li><ks>INDOOR-area</ks>: Specific position outside the parking area delegated to the positioning of the car before the loading operation performed by the trolley from the contiguous position on this side of the INDOOR. </li>
<li><ks>OUTDOOR-area</ks>: Specific position outside the parking area delegated to the positioning of the car before the loading operation performed by the trolley from the contiguous position on this side of the OUTDOOR.This area must be cleared by the user within the time DTFREE.  </li>
<li><ks>weigthsensor</ks>: Sensor that measures the weight of the car. It has the possibility to communicate the measurement performed. </li>
<li><ks>weigth</ks>: Car weight measurement. </li>
<li><ks>outsonar</ks>: Sensor that detects the presence / absence of the car. Has the ability to communicate presence / absence.  </li>
<li><ks>parking-slots</ks>: Areas where it is possible to unload / load a car.The trolley cannot enter these areas.The number of these areas is limited to 6.The position of these areas (marked by inside the map) within the parking-area is defined by a file (parkingMap.txt)..  </li>
<li><ks>thermometer </ks>: Sensor that measures the temperature of the car. It has the possibility to communicate the measurement performed..  </li>
<li><ks>TA</ks>: Temperature value of thermometer. </li>
<li><ks>fan</ks>: Device delegated to decrease the temperature in the parking area. It can be controlled via the network by the system. It has two modes : on and off. It can be switched off automatically or following a command from the operator (parking-manager).  </li>
<li><ks>TMAX</ks>: Thermometer temperature above which an alarm is triggered. </li>
<li><ks>RD</ks>: Elementary unit of measurement of the length of the map.For example, the space occupied by the trolley is an RD X RD, the space occupied by a slot is RD X RD. </li>
<li><ks>fixed obstacles</ks>: Impassable positions for the trolley on the map. In the parkingMap.txt file they are marked with an X at the border or at 1 RD from the border. </li>
<li><ks>parking-manager</ks>: Parking Supervisor. It has the right to: start \ stop of the trolley, start \ stop of the fan.Monitors: the temperature, the alarm for exceeding the exit parking time (DTFREE). </li>
<li><ks>SLOTNUM</ks>: Slot available where cars can be unloaded / loaded inside the parking area.The minimum value is 0, the maximum value is 6. SLOTNUM == 0 means no slot is avaliable. </li>
<li><ks>CARENTER</ks>: Name of the button to press after the customer has parked the car in the INDOOR-AREA.After pressing the button, the trolley, as soon as it is available,it will come to load the car and take it to the position in front of the established SLOT and then perform the unloading of the car.. </li>
<li><ks>ParkServiceGUI</ks>: Graphic interface for the service user. It allows you to: request entry to the parking area (CARREQUEST  button) , if there are slots available (SLOTNUM> 0) then a TOKENID containing a progressive number and the slot in which the car will be parked will be provided through a label, a button of CARENTER to start the parking process. </li>
<li><ks>TOKENID</ks>: String containing a unique progressive number and the slot number (SLOTNUM) where the car is parked. Identifies a car and the slot where it is parked. Regular Expression : "\d{3,}\-[1-6]" like 123-4 , it means progressive 123 at slot 4</li>
<li><ks>ParkServiceStatusGUI </ks>: Graphical interface for the manager. To see the functions of the GUI see the requirements of the parking-manager. </li>
<li><ks>current state</ks>: Set of variables that define the system such as: trolley position, weight sensor value, alarm for exceeding the TDFREE time in OUTDOOR-area, value of the TA temperature sensor, alarm for exceeding the TMAX temperature value, fan status (on \ off), Trolley status (idle, working, stopped), SLOTNUM value, occupancy status of each slot. </li>
<li><ks>state of the fan</ks>: Status of the fan. The possible states are: on, off. </li>
<li><ks>start/stop of the fan</ks>: Commands that can be sent to the fan. The commands that can be sent are: start, stop. </li>
<li><ks>alarm </ks>: Alarm that is displayed in the manager GUI when a car in the OUTDOOR-area does not free the position in DTFREE time. The alarm stops when the car clears the position.Note: the sensor at the OUTDOOR-park is responsible for detecting the presence / absence of the car. </li>
<li><ks>CARSLOTNUM</ks>: Number of slot where a car is parked.Duplicated entity with SLOTNUM? </li>
<li><ks>acceptIN</ks>: Following a customer's request (CARENTER): if a slot is free (SLOTNUM> 0) then the TOKENID is generated and inserted in the ParkQueue queue and the TOKENID is sent to the customer otherwise the TOKENID ("0") is generated and sent to the client. </li>
<li><ks>start/stop of the transport trolley</ks>: Commands that can be sent to the trolley. The commands that can be sent are: start, stop. </li>
 </li>
</ul>

 <p/>
 Additional concepts are added here :
  <p/>
<ul>
<li><ks>CARREQUEST  </ks>:Button present in the ParkServiceGUI, which notifies the system the desire to enter the parking area. </li>
<li><ks>FRONT-SLOT</ks>: Position to the side of the slots from which it is possible to carry out the loading and unloading operations. </li>
<li><ks>ParkQueue</ks>: Queue containing the TOKENIDs of the cars : parked in the slots, currently in the INDOOR-Area waiting to be transported from the INDOOR-Area to the slots or currently on the trolley towards the slots, currently in the slots waiting to be transported from the slots to the OUTDOOR-Area or currently on the trolley in the direction of the OUTDOOR-Area or in the OUTDOOR-Area awaiting exit from the system.  </li>
<li><ks>permitted areas</ks>: Area walkable by the trolley </li>
</ul>
<p/>
 Contradictions , Duplicated and overlap requirement :
<p/>
<li><ks>SLOTNUM and CARSLOTNUM </ks>: it seems describe the same concept</li>
<li><ks>If SLOTNUM==0: moveToHome: if not already at home, move the transport trolley to its home location.</ks>: in the case 5 slot are occupated and trolley it's performing moveToSlotIn task, trolley must go home replacing current task.Final state will be trolley at home with a loaded car. Any other task are impossible.</li>

<h2>Problem analysis</h2>


In the customer's requirements the map in the html file has one form and in the parkingMap.txt file it has another one, in the following analyzes the one in the file is taken as valid. The map has some ambiguities: for example the positions of the slots are not numbered, and neither are the positions of the loading / unloading areas. The team proposes to change the map symbols like this:
	<pre>
X,  X,  X,  X,  X,  X,  X,  X,
X,  <strong>H</strong>,  0,  0,  0,  0,  <strong>I</strong>,  X,
X,  0, A1, S1, S4, A3,  0,  X, 
X,  0, A2, S2, S5, A5,  X,  X, 
X,  0, A3, S3, S6, A6,  0,  X, 
X,  0,  0,  0,  0,  0,  <strong>O</strong>,  X, 
X,  X,  X,  X,  X,  X,  X,  X
 </pre>
 <strong>Position : </strong>
 <ul>
   <li><strong>H</strong> : Home position of the trolley. Here trolley execute Sleep operation </li>
   <li><strong>I</strong> : position from which can Upload a car </li>
   <li><strong>O</strong> : position from which can Download a car </li>
   <li><strong>An</strong> : front-slot <strong>A</strong>rea from which can Download\Upload a car </li>
   <li><strong>Sn</strong> : <strong>S</strong> where cars are parked </li>
 </ul>
 
The trolley stops only in fixed positions, continuous positions between two map coordinates are not possible.
The trolley can perform the operation (OP) of walk (W), turn left (L), turn right (R), sleep (S), load (U) and unload (D).
These characters (W, L, R, U, D, S) are part of the ROUTEHI alphabet, while the lower case version of the ROUTELO alphabet (see: Logic Architecture).
In order to identify each position, through coordinates (x, y), of the map without ambiguity, new concepts are introduced:
<p/>
 All positions are divided into:
 <ul>
<li><strong>ReachablePoint</strong></li>
The trolley can enter these positions.
The accessible positions are those with the symbols H, 0, An, I and O.
These positions are divided into:
<ul>
<li><strong>KeyPoint</strong></li>
In these positions the trolley can be stopped to carry out the
loading / unloading operations or Sleep in the case of H (Home).
<p/>
These positions are divided into:
<ul>
<li><strong>End-point</strong></li>
In these positions the trolley could receive a new Plan.
In the positions of An it can carry out loading and unloading operations. (FRONT-SLOT)
In the H position it can perform the sleep operation.
In the O position it can perform the unloading operation.
<ul>
<li><strong>Avaliable-Point</strong></li>
In these positions the trolley receives a new Plan after the unloading or sleep operations or in other words is becames "Avaliable" after the D or S operation.<br>
In the An positions after the unloading operation, the trolley receives a new Plan .<br>
In the O position, after the unloading operation, the trolley receives a new Plan.<br>
In the position of H after the sleep operation it receives a new plan if it exists otherwise it remains in this position until a new Plan is received.<br>
</ul>
<li><strong>No-End-Point</strong></li>
The only position is I and in this position the trolley cannot receive a new Plan.<br>
In the I position it can perform the loading operation.<br>
</ul>
<li><strong>OnlyMovePoint</strong></li>
In these positions the trolley does not carry out operations of any kind, it can only transit.<br>
</ul>
<li><strong>UnReachablePoint</strong></li>
The inaccessible positions are those are marked with X and Sn.<br>
</ul>
</ul>



<p>
The system requires a research phase to determine the execution times of the operations like w.
At the end of this phase, it may be necessary to introduce a trolley calibration every time it reaches the corner positions such as I, O and H.
This calibration will exploit the object-detection functions of the virtual environment , due to this update logical architecture will be upgraded.
<p>
<h4>Table of SubPlan</h4>
<img src="img\SubPlan.png" class="marginauto" alt="SubPlan" style='height: 75%; width: 75%; object-fit: contain' align="middle">
<p>
The SubPlan table defines the path of the trolley from a <strong>KeyPoint</strong> from to another <strong>KeyPoint</strong> to and the operation to be performed upon reaching the target KeyPoint and the name of the task.
The consideration that can be made is that the tasks moveToIn, moveToSlotIn, backToHome, moveToHome, moveToSlotOut, moveToOut can be considered as Subplans.
To complete a customer request, for example a pick up 2 Subplans are required.
This sequence is called Plan, this implies that a Plan always starts from one <strong>Avaliable-Point</strong> and ends at another <strong>Avaliable-Point</strong>.
The next table defines all possible Tasks.
<p>

<p>
<h4>Table of SubPlan</h4>
<p>
<img src="img\Tasks.drawio.png" class="marginauto" alt="Tasks" style='height: 50%; width: 50%; object-fit: contain' align="middle">
<p>
As already indicated in the requirements analysis (if SLOTNUM == 0 -> moveToHome), the existence of a requirement in contradiction with the condition that it is not possible to invoke a task that brings the trolley back to Home from any position, and whether or not it has the load, it leads at this point in the problem analysis to ignore this requirement.
<p>

<p>
<h4>Logic Architecture</h4>
<p>
<img src="img\LogicalArchitecture.drawio.png" class="marginauto" alt="LogicalArchitecture" style='height: 50%; width: 50%; object-fit: contain' align="middle">
<p>
The Status actor contains the state of the system. It implements the logic of the acceptIN, informIN, moveToIn, moveToSlotIn, backToHome, moveToHome, acceptOut, findSlot, moveToSlotOut, moveToOut and the mock-object monitor.<br>
It is the only actor who maintains the internal state of the system, all the others are stateless.<br>
Status sends a message to Planner the message READY [TOKENID, current position, destination].<br>
Status contains a ParkInQueue for managing cars in the parking phase, a SlotList for parked cars, and a ParkOutQueue for cars in the collection phase.<br>
Status write a log file for every state change : tasks ,message, sensor , operation , position , queue, list.<br>
<p>
After receiving the READY, the Planner actor creates the PlanString (see: Plan table Plan column) to be sent to Route.<br>
<p>
The Route actor sends the high-level route (ROUTEHI), a sequence of characters to control the trolley [W, R, L, U, D, S], to the Driver actor.<br>
<p>
The Driver actor translates the ROUTEHI into the low-level route (ROUTELO) composed of a sequence of w, r, l, u, d, s followed by the execution time.<br> 
The Driver actor sends the pair r: routetime to Sim at a time with a routetime delay between one sending and the next. Sending can be suspended / resumed by a SIM message.<br>
<p>
The Sim actor contains the mock-objects of: smartthermometer (thermometer + alarm), fan, weigthsensor, outsonar, manager.<br>
Smartthermometer: mock-object that sends a message only when Ta&gt; TMax or Ta &lt;TMax to Status. Includes modeling of the thermometer and alarm management.<br>
All mock-object send messages only on change status.<br>
All mock-objects of the actor Sim send a message to Status.<br>
The Sim actor commands WEnv with cril language(see : <a href="img\VR2021.pdf" target="code">VR2021.pdf</a> )
<p>
The Sim GUI is dedicated to modifying the system state (fan, thermometer, outsensor, weightsensor) and running tests.<br>
<p>
ServerGUI is enabled only after insert proper permission.
<p>
<h4>Table of Plans</h4>
<p>
<img src="img\PlanTable.png" class="marginauto" alt="PlanTable" style='height: 50%; width: 50%; object-fit: contain' align="middle">
<p>
The Plan table identifies under which conditions the Status actor sends the READY command to the Planner actor.<br>
The 4 columns on the right , SlotFree and Position are the variables that identify the name of the Plan (PlanString) that Planner sends to the Router and the corresponding tasks that are performed.<br>
This table has a 1: 1 correspondence with the TestsOfThePlans group of the Test Plan.<br>
Tasks in blue are named MovingTask (see:Test Plan).<br>

<p>
<h4>Sequence diagrams</h4>
<p>
<img src="img\SequenceParkIn.drawio.png" class="marginauto" alt="SequenceParkIn" style='height: 50%; width: 50%; object-fit: contain' align="middle">
<p>
<p>
<p>
<p>
<img src="img\SequenceParkOut.drawio.png" class="marginauto" alt="SequenceParkOut" style='height: 50%; width: 50%; object-fit: contain' align="middle">
<p>

<p>
<h4>Use Cases</h4>
<p>
Use Cases describe the sequence of messages between entities.<br>
This list has a 1: 1 correspondence with the TestOfTheUseCases group of the Test Plan.<br>
<ul>
External
<ul>

<li>1.Car In</li>
<ul>
<li>a)CARREQUEST :  ClientGUI -> Status, Status=>ClientGUI</li>
<li>b)CARENTER      :  ClientGUI -> Status, Status=>ClientGUI, 8.a </li>
<li>c)FinalTestCARREQUEST :  SimGUI ->Sim , Sim ->Status </li>
<li>d)FinalTestCARENTER       :  SimGUI ->Sim , Sim ->Status , 8.a</li>
</ul>
<li>2.Car Out</li>
<ul>
<li>a)PickUp  : ClientGUI -> Status, Status=>ClientGUI, 8.a</li>
<li>b)FinalTestPickUp :  SimGUI ->Sim , Sim ->Status , 8.a</li>
</ul>
<li>3.Fan</li>
<ul>
<li>a)On  Manual :  ServerGUI ->Sim , Sim ->Status , Status-> ServerGUI</li>
<li>b)On  Simulated    :  SimGUI-Sim,  Sim-> Status, Sim->Driver ,Status-> ServerGUI</li>
<li>c)Off Manual : ServerGUI ->Sim , Sim ->Status , Sim->Driver , Status-> ServerGUI</li>
<li>d)Off  Simulated   : SimGUI-Sim,   Sim-> Status, Sim->Driver ,  Status-> ServerGUI</li>
</ul>
<li>4.Temp (Alarm)</li>
<ul>
<li>a)On  Simulated    :  SimGUI-Sim, Sim-> Status, Sim->Driver , Status-> ServerGUI</li>
<li>b)Off  Simulated   :  SimGUI-Sim, Sim-> Status, Sim->Driver , Status-> ServerGUI</li>
</ul>
<li>5.Weigthsensor</li>
<ul>
<li>a)On Auto : ClientGUI  -> Status, Status-> ServerGUI</li>
<li>b)Off Auto : Sim -> Status, Status-> ServerGUI</li>
</ul>
<li>6.Outsonar </li>
<ul>
<li>a)On Auto  : Sim -> Status, Status-> ServerGUI</li>
<li>b)Off Auto  : Sim -> Status, Status-> ServerGUI</li>
<li>c)OverTime Simulated : SimGUI=>Sim, Sim -> Status, Status-> ServerGUI</li>
</ul>

<li>7.Trolley</li>
<ul>
<li>a)On Manual  : ServerGUI ->Sim , Sim ->Status , Sim->Driver ,  Status-> ServerGUI</li>
<li>b)Off Manual : ServerGUI ->Sim , Sim ->Status , Sim->Driver ,  Status-> ServerGUI</li>
</ul>

<li>Internal</li>
<ul>
<li>8.        Execute Plan </li>
<ul>
<li>a)Auto : Status -> Planner , Planner -> Driver , Driver ->Sim , Sim ->Status , Sim->WEnv , Status->ServerGUI</li>
<li>b)Manual [Simulated]:SimGUI-Sim, Sim -> Status , 8.a</li>
</ul>
</ul>
</ul>
</ul>

<p>
<h4>Test Plan</h4>
<p>

The test plan is divided into 2 groups: the tests concerning the execution of the 13 Plans (see: Plan Table) and the tests concerning the 21 use cases.<br>

Starting and ending position are the following:<br>
O position means that trolley is in O position heading bottom after a D operation or empty.<br>
H position means that trolley is in H position heading bottom after a S operation.<br>
I position means that trolley is in I position heading top after a U operation.<br>
An position with  1&lt;n&lt;3  means that trolley is in An position heading right after a D operation or empty.<br>
An position with  4&lt;n&lt;6  means that trolley is in An position heading left after a D operation or empty.<br>


<h3>Test form Plan Table</h3>
<table style="width: 100%;" border="1">
<tbody>
<tr>
<td>N°</td>
<td>Name</td>
<td>Initial Condition</td>
<td>Goal</td>
<td>Description</td>
<td>Succes</td>
</tr>
<tr>
<td>1</td>
<td>Test N = 5 Table of Plans</td>
<td>n=1,Trolley in O, no slot free</td>
<td>Execute MovingTasks (To An then O)</td>
<td>Push Test 1 in SimGUI</td>
<td>Trolley in O, slot An free others occupated</td>
</tr>
<tr>
<td>2</td>
<td>Test N = 6 Table of Plans</td>
<td>Trolley in O, no slot free</td>
<td>Execute MovingTasks (To H)</td>
<td>Push Test 2 in SimGUI</td>
<td>Trolley in H, no slot free</td>
</tr>
<tr>
<td>3</td>
<td>Test N = 8 Table of Plans</td>
<td>n=2,Trolley in H, no slot free</td>
<td>Execute MovingTasks (To An then O)</td>
<td>Push Test 3 in SimGUI</td>
<td>Trolley in O,slot An free others occupated</td>
</tr>
<tr>
<td>4</td>
<td>Test N = 11 Table of Plans</td>
<td>n=3,Trolley in An, no slot free</td>
<td>Execute MovingTasks (To An then O)</td>
<td>Push Test 4 in SimGUI</td>
<td>Trolley in O,slot An free others occupated</td>
</tr>
<tr>
<td>5</td>
<td>Test N = 12 Table of Plans</td>
<td>n=4,Trolley in An, no slot free</td>
<td>Execute MovingTasks (To H)</td>
<td>Push Test 5 in SimGUI</td>
<td>Trolley in H, no slot free</td>
</tr>
<tr>
<td>6</td>
<td>Test N = 16 Table of Plans</td>
<td>n=5,Trolley in 0, A1 is free</td>
<td>Execute MovingTasks (To I then An)</td>
<td>Push Test 6 in SimGUI</td>
<td>Trolley in An</td>
</tr>
<tr>
<td>7</td>
<td>Test N = 17 Table of Plans</td>
<td>n=6, Trolley in 0, An is occupated</td>
<td>Execute MovingTasks (To An then O)</td>
<td>Push Test 7 in SimGUI</td>
<td>Trolley in 0</td>
</tr>
<tr>
<td>8</td>
<td>Test N = 18 Table of Plans</td>
<td>n=1, Trolley in 0, An is occupated</td>
<td>Execute MovingTasks (To H)</td>
<td>Push Test 8 in SimGUI</td>
<td>Trolley in H, slot unchanged</td>
</tr>
<tr>
<td>9</td>
<td>Test N = 19 Table of Plans</td>
<td>n=2, Trolley in H, An is free</td>
<td>Execute MovingTasks (To I then An)</td>
<td>Push Test 9 in SimGUI</td>
<td>Trolley in An, An is occupated</td>
</tr>
<tr>
<td>10</td>
<td>Test N = 20 Table of Plans</td>
<td>n=3, Trolley in H, An is occupated</td>
<td>Execute MovingTasks (To An then O)</td>
<td>Push Test 10 in SimGUI</td>
<td>Trolley in O, An is free</td>
</tr>
<tr>
<td>11</td>
<td>Test N = 22 Table of Plans</td>
<td>n=4,m=5, Trolley in An, An is occupated,Am is free,</td>
<td>Execute MovingTasks (To An then I then Am)</td>
<td>Push Test 11 in SimGUI</td>
<td>Trolley in Am,An is occupated, Am is occupated</td>
</tr>
<tr>
<td>12</td>
<td>Test N = 23 Table of Plans</td>
<td>n=6,m=1, Trolley in An, An is occupated,Am is occupated,</td>
<td>Execute MovingTasks (To An then Am then O)</td>
<td>Push Test 12 in SimGUI</td>
<td>Trolley in O, An is occupated, Am is free</td>
</tr>
<tr>
<td>13</td>
<td>Test N = 24 Table of Plans</td>
<td>n=2, Trolley in An, An is occupated</td>
<td>Execute MovingTasks (To H)</td>
<td>Push Test 13 in SimGUI</td>
<td>Trolley in H, An is occupated</td>
</tr>
</tbody>
</table>

<h3>Test form Use Case</h3>
<table style="width: 100%;" border="1">
<tbody>
<tr>
<td>N°</td>
<td>Name</td>
<td>Initial Condition</td>
<td>Goal</td>
<td>Description</td>
<td>Succes</td>
</tr>
<tr>
<td>1</td>
<td>1.Car In.a.CARREQUEST</td>
<td>weightsensor=off,some slot free</td>
<td>Parkin phase CARREQUEST</td>
<td>Push CARREQUEST in ClientGUI</td>
<td>ClientGUI show slotnum</td>
</tr>
<tr>
<td>2</td>
<td>1.Car In.a.CARENTER </td>
<td>After a CARREQUEST</td>
<td>Parkin phase CARENTER</td>
<td>Push CARENTER in ClientGUI</td>
<td>ClientGUI show TOKENID</td>
</tr>
<tr>
<td>3</td>
<td>1.Car In.a.FinalTestCARREQUEST </td>
<td></td>
<td>See test "AL TERMINE DEL LAVORO"</td>
<td>Push FinalTestCARREQUEST in SimGUI</td>
<td>See Status log for state change</td>
</tr>
<tr>
<td>4</td>
<td>1.Car In.a.FinalTestCARENTER  </td>
<td></td>
<td>See test "AL TERMINE DEL LAVORO"</td>
<td>Push FinalTestCARENTER  in SimGUI</td>
<td>See Status log for state change</td>
</tr>
<tr>
<td>5</td>
<td>1.Car In.a.FinalTestPickUp   </td>
<td></td>
<td>See test "AL TERMINE DEL LAVORO"</td>
<td>Push FinalTestPickUp   in SimGUI</td>
<td>See Status log for state change</td>
</tr>
<tr>
<td>6</td>
<td>1.Car In.a.FinalTestComplete   </td>
<td></td>
<td>See test "AL TERMINE DEL LAVORO"</td>
<td>Push FinalTestComplete   in SimGUI</td>
<td>See Status log for state change</td>
</tr>
</tbody>
</table>
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:left;color:white">
mail : ugo.marchesini@studio.unibo.it  
</div> 
</body>
</html>